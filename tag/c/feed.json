{
    "version": "https://jsonfeed.org/version/1",
    "title": "null â€¢ All posts by \"c\" tag",
    "description": "ğŸŒ¸",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/course/Integer-overflow/",
            "url": "http://example.com/course/Integer-overflow/",
            "title": "Integer overflow",
            "date_published": "2024-10-26T10:33:32.000Z",
            "content_html": "<h1 id=\"Integer overflow\" class=\"active\"><a class=\"anchor\"  href=\"#Integer overflow\">#</a>Integer overflow</h1>\n When the result of an integer operation does not fit within the allocated memory space. All common languages are affected \n<ol>\n<li>How Does an Integer Overflow Happen?\n<ol>\n<li>æ— ç¬¦å·æ•´æ•°æº¢å‡ºï¼šä¾‹å¦‚ï¼Œä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•´æ•°çš„èŒƒå›´æ˜¯ 0 åˆ° 4,294,967,295ï¼ˆå³ 2**32 âˆ’ 1 æˆ– 0xffffffffï¼‰ã€‚å¦‚æœæˆ‘ä»¬æ‰§è¡Œè®¡ç®— 4,294,967,295 + 1ï¼Œåˆ™ä¼šå¯¼è‡´æº¢å‡ºï¼Œå› ä¸ºç»“æœè¶…å‡ºäº†æ— ç¬¦å·æ•´æ•°çš„èŒƒå›´</li>\n<li>æœ‰ç¬¦å·æ•´æ•°æº¢å‡º</li>\n</ol>\n<ul>\n<li>ç¬¦å·ä½çš„æº¢å‡º<br>\nå½“ä¸€ä¸ªæ•´æ•°è¿ç®—çš„ç»“æœè¶…è¿‡æœ‰ç¬¦å·æ•´æ•°çš„èŒƒå›´æ—¶ï¼Œç¬¦å·ä½ï¼ˆæœ€é«˜ä½ï¼‰å¯èƒ½ä¼šè¢«è¦†ç›–ï¼Œä»è€Œå¼•å‘æº¢å‡ºã€‚<br>\næœ‰ç¬¦å·æ•´æ•°çš„ç¬¦å·ä½ï¼šåœ¨æœ‰ç¬¦å·æ•´æ•°ä¸­ï¼Œæœ€é«˜ä½ç”¨æ¥è¡¨ç¤ºæ•°å€¼çš„æ­£è´Ÿã€‚ä¾‹å¦‚ï¼Œ32 ä½æœ‰ç¬¦å·æ•´æ•°çš„æœ€é«˜ä½æ˜¯ç¬¬ 31 ä½ï¼ˆç¬¬ 0 ä½åˆ°ç¬¬ 30 ä½æ˜¯æ•°å€¼ä½ï¼‰ã€‚æº¢å‡ºå¯¼è‡´ç¬¦å·å˜åŒ–ï¼šå¦‚æœè¿ç®—ç»“æœè¶…å‡ºæ­£æ•°èŒƒå›´ï¼Œç¬¦å·ä½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œè¿™ä¼šå¯¼è‡´æ•°å€¼è¢«è§£é‡Šä¸ºè´Ÿæ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨ 32 ä½æœ‰ç¬¦å·æ•´æ•°ä¸­ï¼Œ+2,147,483,647 + 1 ä¼šå¯¼è‡´æ•°å€¼å˜æˆ -2,147,483,648ï¼Œå› ä¸ºç¬¦å·ä½è¢«æ”¹å˜ã€‚</li>\n<li>å‘ä¸‹ç±»å‹è½¬æ¢ï¼ˆDowncastingï¼‰å’Œæ•°å€¼æˆªæ–­ï¼ˆTruncationï¼‰\n<ul>\n<li>å‘ä¸‹ç±»å‹è½¬æ¢ï¼šæŒ‡å°†ä¸€ä¸ªé«˜ç²¾åº¦çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºä½ç²¾åº¦çš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå°† long ç±»å‹è½¬æ¢ä¸º int æ—¶ï¼Œå¦‚æœåŸå§‹å€¼è¶…è¿‡ int çš„èŒƒå›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼æˆªæ–­ã€‚</li>\n<li>æ•°å€¼æˆªæ–­å¯èƒ½å¯¼è‡´æº¢å‡ºï¼šæˆªæ–­å‘ç”Ÿæ—¶ï¼Œè¾ƒé«˜ä½çš„æ•°å€¼ä¼šè¢«å¿½ç•¥ï¼Œåªä¿ç•™ä½ä½éƒ¨åˆ†ã€‚è¿™å¯èƒ½å¯¼è‡´æ•°å€¼é”™è¯¯ï¼Œç”šè‡³è§¦å‘æ•´æ•°æº¢å‡ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª 64 ä½çš„ long ç±»å‹è¢«è½¬æ¢ä¸º 32 ä½çš„ int ç±»å‹ï¼Œè€Œå…¶æ•°å€¼è¶…è¿‡äº† 32 ä½æ•´æ•°çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆé«˜ä½å°†è¢«æˆªæ–­ï¼Œåªä¿ç•™ä½ 32 ä½ï¼Œå¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–é”™è¯¯çš„è®¡ç®—ç»“æœã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Risks of Integer Overflow<br>\nMostly lead to program errors, but can have severe consequences</li>\n</ol>\n<ul>\n<li>Buffer overflow occurs when an integer overflow happens in calculating the length of the buffer</li>\n<li>Erroneous program behaviours in mission critical software Incorrect financial calculations</li>\n</ul>\n<h1 id=\"Real-World Examples\" class=\"active\"><a class=\"anchor\"  href=\"#Real-World Examples\">#</a>Real-World Examples</h1>\n<ol>\n<li>Integer Overflow Leads to Buffer Overflow in OpenSSH 3.3</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nresp = packet_get_int(); </span><br><span class=\"line\"> <span class=\"keyword\">if</span> (nresp &gt; <span class=\"number\">0</span>) </span><br><span class=\"line\"> &#123; </span><br><span class=\"line\"> \tresponse = xmalloc(nresp * <span class=\"keyword\">sizeof</span>(<span class=\"type\">char</span> *)); </span><br><span class=\"line\"> \t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; nresp; i++) </span><br><span class=\"line\"> \t\tresponse[i] = packet_get_string(<span class=\"literal\">NULL</span>); </span><br><span class=\"line\"> &#125; </span><br></pre></td></tr></table></figure>\n<p>When  <code>nresp</code>  is 1073741824 (1073741824*4=4294967296=2**32), results in an overflow</p>\n<ul>\n<li><code>xmalloc()</code>  receives and allocates a 0-byte buffer</li>\n<li>The subsequent loop causes a heap buffer overflow (å½“å¾ªç¯è¯•å›¾å°†æ•°æ®å†™å…¥åˆ°  <code>response</code>  æ—¶ï¼Œç”±äº  <code>response</code>  å¹¶æœªçœŸæ­£åˆ†é…å†…å­˜ï¼Œå†™å…¥æ“ä½œä¼šè¦†ç›–å…¶ä»–å†…å­˜åŒºåŸŸï¼Œå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚)</li>\n<li>fixed:  <code>if (nresp &gt; 0 &amp;&amp; nresp &lt;= SIZE_MAX / sizeof(char *))</code></li>\n</ul>\n<ol start=\"2\">\n<li>A Real-World Vulnerability in the Handling JPEG Files</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">getComment</span><span class=\"params\">(<span class=\"type\">unsigned</span> <span class=\"type\">int</span> len, <span class=\"type\">char</span> *src)</span> </span><br><span class=\"line\"> &#123; </span><br><span class=\"line\"> \t<span class=\"type\">unsigned</span> <span class=\"type\">int</span> size; </span><br><span class=\"line\"> \tsize = len â€ <span class=\"number\">2</span>; </span><br><span class=\"line\"> \t<span class=\"type\">char</span> *comment = (<span class=\"type\">char</span> *)<span class=\"built_in\">malloc</span>(size + <span class=\"number\">1</span>); </span><br><span class=\"line\"> \t<span class=\"built_in\">memcpy</span>(comment, src, size); </span><br><span class=\"line\"> \t<span class=\"keyword\">return</span>; </span><br><span class=\"line\"> &#125; </span><br></pre></td></tr></table></figure>\n<ul>\n<li>æ•´æ•°ä¸‹æº¢<br>\nåœ¨è¿™æ®µä»£ç ä¸­ï¼Œå˜é‡  <code>len</code>  å’Œ  <code>size</code>  è¢«å£°æ˜ä¸ºæ— ç¬¦å·æ•´æ•°ï¼ˆunsigned intï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„å€¼ä¸èƒ½æ˜¯è´Ÿæ•°ã€‚<br>\nå½“  <code>len</code>  å°äº 2 æ—¶ï¼Œè®¡ç®—  <code>size = len - 2</code>  ä¼šå¯¼è‡´ æ•´æ•°ä¸‹æº¢ï¼š<br>\nä¾‹å¦‚ï¼Œ <code>len</code>  ä¸º 1 æ—¶ï¼Œ <code>size</code>  å°†å˜ä¸º 0xffffffffï¼ˆ4294967295ï¼‰ï¼Œå³æ— ç¬¦å·æ•´æ•°çš„æœ€å¤§å€¼ã€‚<br>\nä¸‹æº¢çš„åŸå› åœ¨äºæ— ç¬¦å·æ•´æ•°çš„è¿ç®—ç‰¹æ€§ï¼Œå½“å‡æ³•ç»“æœä¸ºè´Ÿæ—¶ï¼Œä¼šå›ç»•ï¼ˆwrap aroundï¼‰åˆ°æœ€å¤§å€¼ã€‚</li>\n<li>0 å­—èŠ‚å†…å­˜åˆ†é…<br>\nåœ¨ä¸‹æº¢çš„æƒ…å†µä¸‹ï¼Œå½“  <code>size</code>  è¢«è®¾ç½®ä¸º 0xffffffff æ—¶ï¼Œè¡¨è¾¾å¼  <code>size + 1</code>  å˜ä¸º 0ã€‚<br>\nè¿™ä¼šå¯¼è‡´  <code>malloc(0)</code> ï¼Œå³åˆ†é…ä¸€ä¸ª 0 å­—èŠ‚çš„ç¼“å†²åŒºã€‚<br>\nåœ¨è®¸å¤šç³»ç»Ÿä¸­ï¼Œ0 å­—èŠ‚çš„  <code>malloc()</code>  æ˜¯åˆæ³•çš„ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†è¯¥æŒ‡é’ˆä¸èƒ½è¢«å†™å…¥ä»»ä½•æ•°æ®ã€‚</li>\n<li>å †ç¼“å†²åŒºæº¢å‡º<br>\n <code>memcpy(comment, src, size)</code>  å°†ä»  <code>src</code>  å¤åˆ¶  <code>size</code>  ä¸ªå­—èŠ‚åˆ°  <code>comment</code> ï¼Œå…¶ä¸­  <code>size</code>  çš„å€¼ä¸º 0xffffffffã€‚<br>\nç”±äº  <code>comment</code>  æ˜¯ä¸€ä¸ª 0 å­—èŠ‚çš„ç¼“å†²åŒºï¼Œè¿™å°†å¯¼è‡´ å †ç¼“å†²åŒºæº¢å‡ºï¼Œå¯èƒ½è¦†ç›–å…¶ä»–å †å†…å­˜åŒºåŸŸï¼Œä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚</li>\n<li>ä¿®å¤</li>\n</ul>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (len &lt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> <span class=\"type\">unsigned</span> <span class=\"type\">int</span> size = len - <span class=\"number\">2</span>;</span><br><span class=\"line\"> ...</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>Example 3</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">bool</span> <span class=\"title function_\">CopyStructs</span><span class=\"params\">(InputFile* pInFile, <span class=\"type\">unsigned</span> <span class=\"type\">long</span> count)</span> &#123;</span><br><span class=\"line\">     <span class=\"type\">unsigned</span> <span class=\"type\">long</span> i;</span><br><span class=\"line\">     m_pStructs = new Structs[count]; </span><br><span class=\"line\">     <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; count; i++) &#123; </span><br><span class=\"line\">         <span class=\"keyword\">if</span> (!ReadFromFile(pInFile, &amp;(m_pStructs[i]))) </span><br><span class=\"line\">             <span class=\"keyword\">break</span>; </span><br><span class=\"line\">     &#125; </span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>The C++â€™s  <code>new[]</code>  operator, it is similar to  <code>malloc(count*sizeof(Structs))</code> <br>\nAllocate a buffer smaller than we need, the attacker is able to write over the buffer</p>\n<ul>\n<li>By <strong>overflowing the multiplication operation</strong> internally</li>\n</ul>\n<ol start=\"4\">\n<li>Example 4</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAX_BUF 256</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">BadCode</span><span class=\"params\">(<span class=\"type\">char</span> *input)</span> </span><br><span class=\"line\"> &#123; </span><br><span class=\"line\">     <span class=\"type\">short</span> len; </span><br><span class=\"line\">     <span class=\"type\">char</span> buf[MAX_BUF]; </span><br><span class=\"line\">     len = <span class=\"built_in\">strlen</span>(input); </span><br><span class=\"line\">     <span class=\"keyword\">if</span> (len &lt; MAX_BUF) </span><br><span class=\"line\">         <span class=\"built_in\">strcpy</span>(buf, input); </span><br><span class=\"line\"> &#125; </span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>strlen()</code>  è¿”å›æ— ç¬¦å·æ•´æ•°<br>\n <code>strlen()</code>  è¿”å›çš„æ˜¯æ— ç¬¦å·æ•´æ•°ç±»å‹ <code>size_t</code> ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª 32 ä½æˆ– 64 ä½æ— ç¬¦å·æ•´æ•°ã€‚<br>\n <code>len</code>  è¢«å®šä¹‰ä¸ºä¸€ä¸ª 16 ä½æœ‰ç¬¦å·çŸ­æ•´å‹ <code>short</code> ï¼Œå…¶èŒƒå›´æ˜¯ -32,768 åˆ° 32,767ã€‚</li>\n<li>ç±»å‹æˆªæ–­å’Œç¬¦å·ç¿»è½¬<br>\nå½“  <code>strlen(input)</code>  è¿”å›çš„é•¿åº¦è¶…è¿‡  <code>32,767</code>  æ—¶ï¼Œèµ‹å€¼ç»™  <code>short len</code>  æ—¶ä¼šå‘ç”Ÿ ç±»å‹æˆªæ–­ï¼Œå¯¼è‡´æº¢å‡ºã€‚<br>\nä¾‹å¦‚ï¼Œå¦‚æœ  <code>strlen(input)</code>  è¿”å› 40,000ï¼Œé‚£ä¹ˆèµ‹å€¼åï¼Œ <code>len</code>  çš„å€¼å°†ä¼šå˜æˆ -25,536ï¼ˆæº¢å‡ºåçš„å€¼ï¼‰ï¼Œå› ä¸º  <code>short</code>  ç±»å‹çš„æœ€å¤§æ­£å€¼åªèƒ½åˆ° 32,767ã€‚<br>\nè¿™ä¼šå°†ä¸€ä¸ªæœ¬åº”æ˜¯å¤§äº 256 çš„å€¼å˜æˆä¸€ä¸ªè´Ÿæ•°ã€‚</li>\n<li>ç¼“å†²åŒºæº¢å‡ºé£é™©<br>\nåœ¨ç±»å‹æˆªæ–­åï¼Œ <code>len</code>  å¯èƒ½æ˜¯è´Ÿæ•°ã€‚æ¡ä»¶  <code>if (len &lt; MAX_BUF)</code>  å°†ä¼šæˆç«‹ï¼Œå› ä¸ºè´Ÿæ•°å°äº 256ã€‚<br>\nè¿™æ„å‘³ç€ï¼Œå³ä½¿è¾“å…¥å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦è¶…è¿‡äº† 256 å­—èŠ‚ï¼Œ <code>strcpy(buf, input)</code>  ä»ä¼šè¢«æ‰§è¡Œï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</li>\n<li>ä¿®å¤<br>\n <code>len = strnlen(input, MAX_BUF);</code> : The  <code>strnlen()</code>  function returns an integer value capped by  <code>MAX_BUF</code></li>\n</ul>\n<h1 id=\"Integer Overflow Prevention\" class=\"active\"><a class=\"anchor\"  href=\"#Integer Overflow Prevention\">#</a>Integer Overflow Prevention</h1>\nInteger overflow is very hard to discover and prevent\n<ol>\n<li>Runtime checks</li>\n</ol>\n<ul>\n<li>ubsan instruments binaries to be executed and checks the results of arithmetic operations</li>\n<li>Microsoft Visual C++ 2005 and later automatically catch calls to operator new that overflow</li>\n</ul>\n<ol start=\"2\">\n<li>Library support</li>\n</ol>\n<ul>\n<li>SafeInt class performs safe operations</li>\n</ul>\n<ol start=\"3\">\n<li>Static analysis tools and formal verification techniques<br>\n åœ¨ç¨‹åºç¼–è¯‘å‰å¯¹æºä»£ç è¿›è¡Œåˆ†æï¼Œå¯»æ‰¾æ½œåœ¨çš„æ•´æ•°æº¢å‡ºé—®é¢˜ã€‚è¿™äº›å·¥å…·å¯ä»¥æ£€æµ‹ä»£ç ä¸­çš„å¸¸è§æ•´æ•°è¿ç®—é”™è¯¯ï¼ŒåŒ…æ‹¬åŠ å‡ä¹˜é™¤æº¢å‡ºã€ç±»å‹è½¬æ¢æº¢å‡ºç­‰</li>\n</ol>\n",
            "tags": [
                "software security",
                "C"
            ]
        },
        {
            "id": "http://example.com/course/Stack-buffer-overflow/",
            "url": "http://example.com/course/Stack-buffer-overflow/",
            "title": "Stack buffer overflow",
            "date_published": "2024-10-26T07:50:30.000Z",
            "content_html": "<h1 id=\"Stack buffer overflow\" class=\"active\"><a class=\"anchor\"  href=\"#Stack buffer overflow\">#</a>Stack buffer overflow</h1>\n<ol>\n<li>The Process Stack</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>Sample Process C Code</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">A</span><span class=\"params\">(<span class=\"type\">int</span> a, <span class=\"type\">int</span> b, <span class=\"type\">int</span> c)</span>  </span><br><span class=\"line\"> &#123; </span><br><span class=\"line\">\t<span class=\"type\">char</span> buffer1[<span class=\"number\">5</span>]; </span><br><span class=\"line\">\t<span class=\"type\">char</span> buffer2[<span class=\"number\">10</span>]; </span><br><span class=\"line\">    \t... </span><br><span class=\"line\"> &#125; </span><br><span class=\"line\"> <span class=\"type\">void</span> <span class=\"title function_\">main</span><span class=\"params\">()</span>  </span><br><span class=\"line\"> &#123; </span><br><span class=\"line\">\tA(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>); </span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(...); </span><br><span class=\"line\">   \t ... </span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://img.picui.cn/free/2024/10/26/671ca1b71cfbb.png\" alt=\"img\"></p>\n<p>åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°å‚æ•°æ˜¯æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºä¾æ¬¡å‹å…¥æ ˆä¸­ã€‚è¿™ç§å‚æ•°ä¼ é€’æ–¹å¼æ˜¯ x86 æ¶æ„çš„æ ‡å‡†åšæ³•ï¼Œç”¨äºä¿è¯å‡½æ•°å‚æ•°åœ¨æ ˆä¸Šçš„æ­£ç¡®é¡ºåºã€‚<br>\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•°  <code>A(int a, int b, int c)</code>  è¢«è°ƒç”¨æ—¶ï¼Œ <code>c</code>  é¦–å…ˆè¢«å‹å…¥æ ˆï¼Œç„¶åæ˜¯  <code>b</code> ï¼Œæœ€åæ˜¯  <code>a</code> ã€‚</p>\n<ol start=\"2\">\n<li>Buffer Overflow</li>\n</ol>\n<ul>\n<li>Occurs when:<br>\nInput is unconstrained<br>\nRuns past the end of a buffer, replacing valid (control) data</li>\n<li>Technique that allows:<br>\nYour code to be executed by another program<br>\nOverflow data area to alter variable values</li>\n<li>Problem: declaration in version of login.c is  <code>char name[80], passwd[80], hash[13];</code> . Attack login procedure:\n<ol>\n<li>User types username, which is stored in name</li>\n<li>Compute hash for the corresponding password</li>\n<li>User types password, pads to 80 chars, and types hash for that password</li>\n<li>The program validates password against user-supplied hash; user is in (with any password)</li>\n</ol>\n</li>\n</ul>\n<ol start=\"3\">\n<li>Stack Smashing<br>\n ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„æ ¸å¿ƒæ˜¯è¦†ç›–æ ˆä¸Šçš„ è¿”å›åœ°å€ï¼ˆretï¼‰ã€‚å½“è¿”å›åœ°å€è¢«è¦†ç›–æ—¶ï¼Œç¨‹åºåœ¨å‡½æ•°è¿”å›æ—¶ä¸ä¼šè·³å›è°ƒç”¨å‡½æ•°çš„ä½ç½®ï¼Œè€Œæ˜¯è·³è½¬åˆ°æ”»å‡»è€…æŒ‡å®šçš„ä½ç½®ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§æŠ€æœ¯è®©ç¨‹åºæ‰§è¡Œä»»æ„ä»£ç ï¼ˆå¦‚æ¶æ„ä»£ç æˆ– shellcodeï¼‰ï¼Œè¿™è¢«ç§°ä¸ºå †æ ˆç ´åã€‚</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>Stack Smashing</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">functionA</span><span class=\"params\">(<span class=\"type\">char</span> *str)</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\t<span class=\"type\">char</span> buffer[<span class=\"number\">16</span>]; </span><br><span class=\"line\">\t<span class=\"built_in\">strcpy</span>(buffer, str);   <span class=\"comment\">//segmentation fault</span></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">main</span><span class=\"params\">()</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\t<span class=\"type\">char</span> large_string[<span class=\"number\">256</span>]; </span><br><span class=\"line\">\t<span class=\"type\">int</span> i; </span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">255</span>; i++) </span><br><span class=\"line\">       &#123; </span><br><span class=\"line\">\t\tlarge_string[i] = <span class=\"string\">&#x27;A&#x27;</span>; </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">\tfunctionA(large_string); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>buffer</code> ï¼šåœ¨  <code>functionA</code>  ä¸­å£°æ˜ä¸º 16 å­—èŠ‚çš„å­—ç¬¦æ•°ç»„ã€‚</li>\n<li><code>strcpy(buffer, str)</code> ï¼šä½¿ç”¨  <code>strcpy</code>  å°†å¤–éƒ¨ä¼ å…¥çš„å­—ç¬¦ä¸² str å¤åˆ¶åˆ° buffer ä¸­ã€‚ç”±äº  <code>strcpy</code>  ä¸æ£€æŸ¥é•¿åº¦ï¼Œå¦‚æœ  <code>str</code>  çš„é•¿åº¦è¶…è¿‡ 16 å­—èŠ‚ï¼Œä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</li>\n<li>åœ¨  <code>main</code>  ä¸­ï¼Œ <code>large_string</code>  æ˜¯ä¸€ä¸ª 256 å­—èŠ‚çš„æ•°ç»„ï¼Œå®ƒè¢«å¡«å……ä¸º 255 ä¸ª â€˜Aâ€™ã€‚å½“  <code>large_string</code>  è¢«ä¼ é€’ç»™  <code>functionA</code>  æ—¶ï¼Œ <code>buffer</code>  è¢«æº¢å‡ºã€‚</li>\n<li>ä¿®å¤ï¼š  <code>strcpy(buffer, str)</code>  --&gt;  <code>strncpy(buffer, str, 16);</code></li>\n</ul>\n<p><img data-src=\"https://img.picui.cn/free/2024/10/26/671ca87ccb1e2.png\" alt=\"img\"><br>\n <code>large_str</code>  has overflowed  <code>buffer</code>  and  <code>sfp</code>  and  <code>ret</code>  and  <code>*str</code> .Note that  <code>ret</code>  is the return address!<br>\nThis means we can get the function to return to any point in the code that we specify.</p>\n<ul>\n<li>Buffer overflows allow us to change return address\n<ol>\n<li>Can point to any function in the library</li>\n<li>Can point to own code</li>\n</ol>\n</li>\n<li>Add code in the overflowed buffer\n<ol>\n<li>Run at privilege of process (very useful if root!)</li>\n<li>Even a small buffer can invoke a shell using the system call (often called shellcode)</li>\n</ol>\n</li>\n<li>Attacker would like to run shell at root level\n<ol>\n<li>Make system call to  <code>execve</code> , passing  <code>/bin/sh</code></li>\n<li>Needs to be part of the buffer, and in assembly code (ä»¥ä¾¿ç²¾ç¡®æ§åˆ¶å…¶å¤§å°å’ŒåŠŸèƒ½)</li>\n<li>Program has to fit in buffer without overwriting return address (å¦‚æœ shellcode è¦†ç›–äº†è¿”å›åœ°å€æœ¬èº«ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒè€Œæ— æ³•æ‰§è¡Œæ”»å‡»ä»£ç )</li>\n<li>Pad out buffer to return address, and point return address to start of buffer</li>\n<li>Donâ€™t generate core dump (this will cause suspicion)</li>\n</ol>\n</li>\n</ul>\n<ol start=\"4\">\n<li>What do You Need to Hack a Buffer Overflow\n<ol>\n<li>Address where buffer begins</li>\n</ol>\n<ul>\n<li>Easy to get if you have access to the same type of system being attacked</li>\n<li>Can use Null Operation (NOP) commands to make the target address bigger</li>\n</ul>\n<ol start=\"2\">\n<li>Location where return address is stored</li>\n</ol>\n<ul>\n<li>Can pad out the buffer with return address</li>\n</ul>\n<ol start=\"3\">\n<li>Assembly language program to spawn a shell (shellcode payload)</li>\n</ol>\n<ul>\n<li>Can use gdb to disassemble a program for you</li>\n</ul>\n</li>\n<li>Affected Languages</li>\n</ol>\n<p>Buffer overflows mainly occur in low-level programming languages that allow direct memory access: Assembler, C, C++<br>\nNote that some high-level languages such as Java, C# and Visual Basic are written in C, C++ or call modules written in these languages</p>\n<ol start=\"6\">\n<li>\n<p>Buffer Overflow Examples<br>\nFunctions that handle arrays but do not check length (checking for termination character is insufficient) In C/C++,   <code>gets</code> ,  <code>strcpy</code> ,  <code>strcat</code> ,  <code>sprintf</code></p>\n<ol>\n<li>Example 1</li>\n</ol>\n</li>\n</ol>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> buf[<span class=\"number\">20</span>]; </span><br><span class=\"line\"> gets(buf);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p><code>char buf[20]</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªé•¿åº¦ä¸º 20 çš„å­—ç¬¦æ•°ç»„  <code>buf</code> ã€‚</p>\n</li>\n<li>\n<p><code>gets(buf)</code> ï¼šä½¿ç”¨  <code>gets()</code>  å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–å­—ç¬¦ä¸²ï¼Œå¹¶å­˜å‚¨åœ¨  <code>buf</code>  ä¸­</p>\n</li>\n<li>\n<p><code>gets()</code>  å‡½æ•°ä¸æ£€æŸ¥è¾“å…¥çš„é•¿åº¦ï¼Œæ„å‘³ç€å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡äº†  <code>buf</code>  çš„å¤§å°ï¼ˆ20 å­—èŠ‚ï¼‰ï¼Œåˆ™ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚</p>\n</li>\n<li>\n<p>ä¿®å¤ï¼š  <code>fgets(buf, sizeof(buf), stdin);</code></p>\n<ol start=\"2\">\n<li>Example 2</li>\n</ol>\n</li>\n</ul>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> buf[<span class=\"number\">20</span>]; </span><br><span class=\"line\"> <span class=\"type\">char</span> prefix[] = <span class=\"string\">&quot;http://&quot;</span>; </span><br><span class=\"line\">   ... </span><br><span class=\"line\">   <span class=\"comment\">// copies the string prefix to buf </span></span><br><span class=\"line\"> <span class=\"built_in\">strcpy</span>(buf, prefix); </span><br><span class=\"line\">   <span class=\"comment\">// concatenates path to the string buf </span></span><br><span class=\"line\"> <span class=\"built_in\">strncat</span>(buf, path, <span class=\"keyword\">sizeof</span>(buf));</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p><code>char buf[20]</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªé•¿åº¦ä¸º 20 å­—èŠ‚çš„å­—ç¬¦æ•°ç»„  <code>buf</code> ã€‚</p>\n</li>\n<li>\n<p><code>char prefix[] = &quot;http://&quot;;</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²  <code>&quot;http://&quot;</code>  çš„å­—ç¬¦æ•°ç»„ã€‚</p>\n</li>\n<li>\n<p><code>strcpy(buf, prefix)</code> ï¼šå°†å­—ç¬¦ä¸²  <code>&quot;http://&quot;</code>  å¤åˆ¶åˆ°  <code>buf</code>  ä¸­ã€‚</p>\n<ul>\n<li>é—®é¢˜ï¼š <code>&quot;http://&quot;</code>  é•¿åº¦ä¸º 7 å­—èŠ‚ï¼ˆåŒ…æ‹¬ç»ˆæ­¢ç¬¦ \\0ï¼‰ï¼Œåœ¨å¤åˆ¶åï¼Œ <code>buf</code>  ä¸­åªå‰©ä¸‹ 13 ä¸ªå­—èŠ‚å¯ç”¨ã€‚</li>\n</ul>\n</li>\n<li>\n<p><code>strncat(buf, path, sizeof(buf))</code> ï¼šå°†å­—ç¬¦ä¸²  <code>path</code>  è¿æ¥åˆ°  <code>buf</code>  ä¸­ï¼ŒæŒ‡å®šçš„æœ€å¤§é•¿åº¦ä¸º  <code>sizeof(buf)</code> ï¼ˆå³ 20 å­—èŠ‚ï¼‰ã€‚</p>\n<ul>\n<li>é—®é¢˜ï¼šè¿™é‡Œçš„  <code>sizeof(buf)</code>  æ˜¯ 20 å­—èŠ‚ï¼Œä½†åœ¨å‰é¢å·²ç»ç”¨æ‰äº† 7 å­—èŠ‚ï¼ˆåŒ…æ‹¬ç»ˆæ­¢ç¬¦ï¼‰ã€‚ <code>strncat()</code>  è¯•å›¾è¿½åŠ   <code>path</code>  çš„å†…å®¹æ—¶ï¼Œå¯èƒ½ä¼šè¶…å‡º  <code>buf</code>  çš„å‰©ä½™ç©ºé—´ï¼ˆ13 å­—èŠ‚ï¼‰ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</li>\n</ul>\n</li>\n<li>\n<p>ä¿®å¤ï¼š <code>strncat(buf, path, sizeof(buf) - strlen(buf) - 1);</code></p>\n<ol start=\"3\">\n<li>Example 3</li>\n</ol>\n</li>\n</ul>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> buf[<span class=\"number\">32</span>]; </span><br><span class=\"line\"> <span class=\"built_in\">strncpy</span>(buf, data, <span class=\"built_in\">strlen</span>(data)); </span><br></pre></td></tr></table></figure>\n<p><code>strncpy(buf, data, strlen(data))</code> ï¼šå°†å­—ç¬¦ä¸²  <code>data</code>  å¤åˆ¶åˆ°  <code>buf</code>  ä¸­ï¼Œå¤åˆ¶çš„é•¿åº¦ä¸º  <code>strlen(data)</code> ã€‚</p>\n<ul>\n<li>\n<p>ç¼ºé™· 1ï¼šç¼ºå°‘ç»ˆæ­¢ç¬¦ \\0ï¼š <code>strncpy</code>  ä¸ä¼šè‡ªåŠ¨æ·»åŠ å­—ç¬¦ä¸²çš„ç»ˆæ­¢ç¬¦  <code>\\0</code> ï¼Œå¦‚æœ  <code>data</code>  çš„é•¿åº¦ç­‰äºæˆ–å¤§äº 32ï¼Œé‚£ä¹ˆ  <code>buf</code>  ä¸ä¼šä»¥  <code>\\0</code>  ç»“å°¾ã€‚è¿™å¯èƒ½å¯¼è‡´  <code>buf</code>  è¢«å½“ä½œæœªç»ˆæ­¢çš„å­—ç¬¦ä¸²å¤„ç†ï¼Œå¸¦æ¥ä¸ç¡®å®šçš„è¡Œä¸ºæˆ–å®‰å…¨é£é™©ã€‚</p>\n</li>\n<li>\n<p>ç¼ºé™· 2ï¼šå¯èƒ½çš„ç¼“å†²åŒºæº¢å‡ºï¼šå¦‚æœ  <code>strlen(data) &gt; 32</code> ï¼Œ <code>strncpy</code>  å°†å°è¯•å¤åˆ¶è¶…è¿‡  <code>buf</code>  å¤§å°çš„å†…å®¹ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</p>\n</li>\n<li>\n<p>ä¿®å¤ï¼š <code>strncpy(buf, data, sizeof(buf) - 1); buf[sizeof(buf) - 1] = '\\0';</code></p>\n<ol start=\"4\">\n<li>Example 4</li>\n</ol>\n</li>\n</ul>\n <figure class=\"highlight c\"><figcaption><span>OvO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> buf[MAX_PATH]; </span><br><span class=\"line\"> <span class=\"built_in\">sprintf</span>(buf, <span class=\"string\">&quot;%s - %d\\n&quot;</span>, path, errno);</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>sprintf(buf, &quot;%s - %d\\n&quot;, path, errno)</code>  ä¼šå°†  <code>path</code>  å’Œ  <code>errno</code>  çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤åˆ¶åˆ°  <code>buf</code>  ä¸­ã€‚</li>\n<li><code>sprintf</code>  ä¸æ£€æŸ¥  <code>buf</code>  çš„å¤§å°æ˜¯å¦è¶³ä»¥å®¹çº³æ ¼å¼åŒ–åçš„ç»“æœã€‚å¦‚æœ  <code>path</code>  å¾ˆé•¿ï¼ŒåŠ ä¸Šæ•°å­—  <code>errno</code>  å’Œå…¶ä»–å­—ç¬¦ï¼Œå¯èƒ½ä¼šè¶…è¿‡  <code>MAX_PATH</code> ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</li>\n<li>ä¿®å¤ï¼š  <code>snprintf(buf, sizeof(buf), &quot;%s - %d\\n&quot;, path, errno);</code></li>\n</ul>\n<h1 id=\"Stack buffer overflow prevention\" class=\"active\"><a class=\"anchor\"  href=\"#Stack buffer overflow prevention\">#</a>Stack buffer overflow prevention</h1>\n<ol>\n<li>Spotting Buffer Overflows</li>\n</ol>\n<ul>\n<li>Check inputs, whether read from the network, a file, or from the command line</li>\n<li>Check transfer of data from said input to internal structures</li>\n<li>Look for use of unsafe string handling calls</li>\n<li>Look for use of arithmetic to calculate an allocation size or remaining buffer size</li>\n</ul>\n<ol start=\"2\">\n<li>Fixing Buffer Overflows</li>\n</ol>\n<ul>\n<li>Replace dangerous string handling functions</li>\n<li>Replace C string buffers with C++ strings</li>\n<li>Replace static arrays with STL containers</li>\n<li>Use analysis tools, Examples include Fortify, Coverity, PREfast, and Klocwor</li>\n</ul>\n<ol start=\"3\">\n<li>Code Analysis</li>\n</ol>\n<ul>\n<li>Statically check source to detect buffer overflows s</li>\n<li>Several tools exist to automate the review process<br>\nStanford:  Engler, et al.  Test trust inconsistency<br>\n@stake.com  (<span class=\"exturl\" data-url=\"aHR0cDovL2wwcGh0LmNvbQ==\">l0pht.com</span>): SLINT (designed for UNIX)<br>\nBerkeley:  Wagner, et al.  Test constraint violations</li>\n<li>Find lots of bugs, but not all</li>\n</ul>\n<ol start=\"4\">\n<li>Marking Stack as Non-Execute<br>\nBasic stack exploit can be prevented by marking stack segment as non-executable<br>\nLimitations and Problems</li>\n</ol>\n<ul>\n<li>Some apps need executable stack (e.g. LISP interpreters)</li>\n<li>Does not block more general overflow exploits</li>\n<li>Overflow on heap: overflow buffer next to func pointer</li>\n<li>Cannot make all the data segment non-executable</li>\n<li>More recent UNIX and MS windows emit dynamic code into program data for performance optimisations</li>\n</ul>\n<ol start=\"5\">\n<li>Stack Protection and Run-time Checking<br>\nMany run-time checking techniques\n<ol>\n<li>Example:  StackGuard (WireX)</li>\n</ol>\n<ul>\n<li>Run time tests for stack integrity</li>\n<li>Code generator for emitting code to set up and tear down functions</li>\n<li>Embeds â€œcanariesâ€ in stack frames and verify their integrity prior to function return</li>\n</ul>\n<ol start=\"2\">\n<li>Libsafe (Avaya Labs)</li>\n</ol>\n<ul>\n<li>Dynamically loaded library</li>\n<li>Intercepts calls to  <code>strcpy (dest, src)</code>\n<ul>\n<li>Validate sufficient space in current stack frame: |framepointerâ€“dest| &gt; strlen(src)</li>\n<li>If so, does strcpy. Otherwise, terminates application</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Address obfuscation (Stony Brookâ€™03)</li>\n</ol>\n<ul>\n<li>Encrypt return address on stack by XORing with random string. Decrypt just before returning from function</li>\n<li>Attacker needs decryption key to set return address to desired value</li>\n</ul>\n<ol start=\"7\">\n<li>PaX ASLR: Randomise location of libc</li>\n</ol>\n<ul>\n<li>Attacker cannot jump directly to exec function</li>\n</ul>\n",
            "tags": [
                "software security",
                "C",
                "vulnerability"
            ]
        }
    ]
}