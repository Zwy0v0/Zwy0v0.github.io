{
    "version": "https://jsonfeed.org/version/1",
    "title": "null â€¢ All posts by \"sql\" tag",
    "description": "ğŸŒ¸",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/course/SQL-Injection/",
            "url": "http://example.com/course/SQL-Injection/",
            "title": "SQL Injection",
            "date_published": "2024-10-30T02:17:45.000Z",
            "content_html": "<h1 id=\"SQL Injection\" class=\"active\"><a class=\"anchor\"  href=\"#SQL Injection\">#</a>SQL Injection</h1>\n\n<ul>\n<li>Exploit vulnerabilities in input validation to run arbitrary commands in the database <ul>\n<li>Using user input to construct dynamic SQL statements to access the database </li>\n<li>Using stored procedures that are passed strings that contain unfiltered user input</li>\n</ul>\n</li>\n<li>Attacker can execute arbitrary commands in the database <ul>\n<li>Worse if the application uses a privileged account to connect to the database<figure class=\"highlight php\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$selecteduser</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;user&#x27;</span>];  </span><br><span class=\"line\"> <span class=\"variable\">$sql</span> = <span class=\"string\">&quot;SELECT Username, Key FROM Key &quot;</span> .  </span><br><span class=\"line\">        <span class=\"string\">&quot;WHERE Username=&#x27;<span class=\"subst\">$selecteduser</span>&#x27;&quot;</span>; </span><br><span class=\"line\"> <span class=\"variable\">$rs</span> = <span class=\"variable\">$db</span>-&gt;<span class=\"title function_ invoke__\">executeQuery</span>(<span class=\"variable\">$sql</span>); </span><br></pre></td></tr></table></figure>\nåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>$selecteduser</code> æ˜¯ä»ç”¨æˆ·è¾“å…¥ä¸­ç›´æ¥è·å–çš„ï¼Œå®ƒè¢«æ— è¿‡æ»¤åœ°æ’å…¥åˆ° SQL æŸ¥è¯¢ä¸­ã€‚ç”±äºæ²¡æœ‰å¯¹ <code>$selecteduser</code> è¿›è¡Œä»»ä½•è¿‡æ»¤æˆ–è½¬ä¹‰ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è¾“å…¥ä¸­æ·»åŠ æ¶æ„çš„ SQL è¯­å¥ï¼Œæ”¹å˜åŸå§‹æŸ¥è¯¢çš„å«ä¹‰ã€‚å‡è®¾æ”»å‡»è€…æä¾›ä»¥ä¸‹è¾“å…¥ä½œä¸º user å‚æ•°ï¼š<figure class=\"highlight bash\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">admin<span class=\"string\">&#x27; OR &#x27;</span>1<span class=\"string\">&#x27;=&#x27;</span>1 </span><br></pre></td></tr></table></figure>\nè¿™å°†å¯¼è‡´æŸ¥è¯¢å˜æˆï¼š<figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> Username, Key <span class=\"keyword\">FROM</span> Key <span class=\"keyword\">WHERE</span> Username<span class=\"operator\">=</span><span class=\"string\">&#x27;admin&#x27;</span> <span class=\"keyword\">OR</span> <span class=\"string\">&#x27;1&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>OR &#39;1&#39;=&#39;1&#39;</code> æ°¸è¿œä¸ºçœŸï¼Œè¿™æ„å‘³ç€æ•°æ®åº“å°†è¿”å›æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ <code>admin</code> ç”¨æˆ·çš„ä¿¡æ¯</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"https://img.picui.cn/free/2024/10/30/6721ec7cbba70.png\" alt=\"img\"></p>\n<h1 id=\"Example\" class=\"active\"><a class=\"anchor\"  href=\"#Example\">#</a>Example</h1>\n\n<p>SQL Injections Can be Used to â€¦</p>\n<ol>\n<li><p>Login<br>SQL æ³¨å…¥ æ˜¯ä¸€ç§é€šè¿‡æ“æ§ç”¨æˆ·è¾“å…¥ï¼Œä½¿ä¹‹ç›´æ¥åµŒå…¥ SQL æŸ¥è¯¢ï¼Œä»è€Œæ”¹å˜æŸ¥è¯¢é€»è¾‘çš„æ”»å‡»æ–¹å¼ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹å¼è·å–æœªç»æˆæƒçš„æ•°æ®åº“è®¿é—®ï¼Œç”šè‡³è·å–æ•æ„Ÿæ•°æ®</p>\n<figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> userFound<span class=\"operator\">=</span><span class=\"keyword\">execute</span>( </span><br><span class=\"line\">   &quot;SELECT * FROM USERS WHERE </span><br><span class=\"line\">    username=&#x27;$username&#x27; AND password=&#x27;$password&#x27;;&quot;); </span><br></pre></td></tr></table></figure>\n<p> To authenticate logins, server runs this SQL command against the user database</p>\n<figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> USERS <span class=\"keyword\">WHERE</span> </span><br><span class=\"line\">  username<span class=\"operator\">=</span><span class=\"string\">&#x27;$username&#x27;</span> <span class=\"keyword\">AND</span> password<span class=\"operator\">=</span><span class=\"string\">&#x27;$password&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>User enters the following as <code>$username</code> and <code>$password</code></p>\n <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27; OR password LIKE &#x27;</span><span class=\"operator\">%</span> </span><br></pre></td></tr></table></figure>\n<p>Server then executes </p>\n <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> USERS <span class=\"keyword\">WHERE</span> </span><br><span class=\"line\">  username<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">OR</span> password <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">AND</span>  </span><br><span class=\"line\">  password<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">OR</span> password <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;%&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><code>username=&#39;&#39; OR password LIKE &#39;%&#39;</code> çš„æ¡ä»¶æ€»æ˜¯ä¸ºçœŸï¼Œå› ä¸º <code>password LIKE &#39;%&#39; </code>å¯ä»¥åŒ¹é…ä»»ä½•å¯†ç ã€‚</p>\n</li>\n<li><p>Steal Data<br>æ”»å‡»è€…ä½¿ç”¨ä¸€ç§å¸¸è§çš„æŠ€å·§ï¼Œé€šè¿‡æ„é€ ç‰¹æ®Šçš„è¾“å…¥ï¼Œä½¿æŸ¥è¯¢æ¡ä»¶æ€»æ˜¯è¿”å› trueï¼Œä»¥ä¾¿è·å–æ›´å¤šçš„æ•°æ®ã€‚<br>When the result is returned to the user</p>\n <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> email <span class=\"keyword\">FROM</span> USERS <span class=\"keyword\">WHERE</span> </span><br><span class=\"line\">  username<span class=\"operator\">=</span><span class=\"string\">&#x27;$username&#x27;</span> <span class=\"keyword\">AND</span> password<span class=\"operator\">=</span><span class=\"string\">&#x27;$password&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>To get more data, attacker gives <code>username</code></p>\n  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27; OR 1=1 #</span></span><br></pre></td></tr></table></figure>\n<p><code>1=1</code> æ˜¯ä¸€ä¸ªå§‹ç»ˆä¸ºçœŸçš„æ¡ä»¶ã€‚<br><code>#</code> (åœ¨ MySQL ä¸­) æˆ– <code>--</code> (åœ¨å…¶ä»– RDBMS ä¸­) è¡¨ç¤ºæ³¨é‡Šç¬¦å·ï¼Œåé¢çš„æ‰€æœ‰å†…å®¹éƒ½è¢«å¿½ç•¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œ<code>AND password=&#39;$password&#39; </code>å°±è¢«æ³¨é‡Šæ‰äº†ï¼Œä¸ä¼šå½±å“æŸ¥è¯¢çš„ç»“æœã€‚<br>å› æ­¤æœ€ç»ˆç»“æœæ˜¯ï¼š</p>\n  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> email <span class=\"keyword\">FROM</span> USERS <span class=\"keyword\">WHERE</span> username<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">OR</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p>ç”±äº <code>WHERE</code> å­å¥æ€»ä¸ºçœŸï¼ŒæŸ¥è¯¢ä¼šè¿”å› <code>USERS</code> è¡¨ä¸­æ‰€æœ‰ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œè€Œä¸ä»…ä»…æ˜¯åŒ¹é…ç‰¹å®šç”¨æˆ·åå’Œå¯†ç çš„è®°å½•ã€‚</p>\n</li>\n</ol>\n<p>ä¹Ÿå¯ä»¥ä»å…¶ä»–æ•°æ®åº“çªƒå–æ•°æ® é€šè¿‡è¾“å…¥<code>username</code><br>  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27; AND 1=0 </span></span><br><span class=\"line\"><span class=\"string\"> UNION SELECT cardholder, number, exp_month, exp_year FROM </span></span><br><span class=\"line\"><span class=\"string\"> creditcards #</span></span><br></pre></td></tr></table></figure><br>ç”±äºç¬¬ä¸€éƒ¨åˆ†çš„æ¡ä»¶ä¸æˆç«‹ï¼ŒåŸæŸ¥è¯¢ä¸è¿”å›ä»»ä½•ç»“æœï¼›ä½† <code>UNION</code> æ“ä½œç¬¦ä½¿å¾—æŸ¥è¯¢çš„ç»“æœå˜æˆä¿¡ç”¨å¡è¡¨ä¸­çš„æ•°æ®ï¼Œä»è€Œè¢«æ”»å‡»è€…è·å–ã€‚</p>\n<ol start=\"3\">\n<li>Run Shell Commands<br>é€šè¿‡åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Š æ‰§è¡Œ shell å‘½ä»¤ï¼Œæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·è´¦æˆ·ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ”»å‡»è€…èƒ½å¤Ÿçªç ´æ•°æ®åº“çš„è¾¹ç•Œï¼Œç›´æ¥å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œä¿®æ”¹ï¼Œä»è€Œä½¿æœåŠ¡å™¨æ›´åŠ å®¹æ˜“å—åˆ°è¿›ä¸€æ­¥çš„æ”»å‡»ã€‚<br>ç”¨æˆ·è¾“å…¥ï¼šæ”»å‡»è€…åœ¨ç”¨æˆ·åå­—æ®µä¸­è¾“å…¥ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;; exec cmdshell &#x27;</span>net <span class=\"keyword\">user</span> badguy badpwd<span class=\"string\">&#x27; /ADD #</span></span><br></pre></td></tr></table></figure>\n<code>&#39;;</code>ï¼šç»“æŸäº†å½“å‰çš„ SQL æŸ¥è¯¢è¯­å¥ã€‚<br><code>exec cmdshell &#39;net user badguy badpwd&#39; /ADD&#39;</code>ï¼šåˆ©ç”¨æ•°æ®åº“æœåŠ¡å™¨çš„ <code>cmdshell</code> åŠŸèƒ½æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåä¸º <code>badguy</code>ï¼Œå¯†ç ä¸º <code>badpwd</code> çš„æ–°ç”¨æˆ·è´¦æˆ·ã€‚<br><code>#</code>ï¼šæ³¨é‡Šç¬¦å·ï¼Œç”¨æ¥å¿½ç•¥åç»­çš„ SQL è¯­å¥ã€‚</li>\n</ol>\n<p>æ³¨å…¥åçš„ SQL æŸ¥è¯¢å˜æˆäº†ï¼š<br>  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> UserTable <span class=\"keyword\">WHERE</span> username<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span>; <span class=\"keyword\">exec</span> cmdshell <span class=\"string\">&#x27;net user badguy badpwd&#x27;</span> <span class=\"operator\">/</span><span class=\"keyword\">ADD</span> #...</span><br></pre></td></tr></table></figure></p>\n<ol start=\"4\">\n<li><p>Changeã€Destory Data<br> Create new users</p>\n  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;; INSERT INTO USERS (&#x27;</span>uname<span class=\"string\">&#x27;,&#x27;</span>passwd<span class=\"string\">&#x27;) </span></span><br><span class=\"line\"><span class=\"string\"> VALUES (&#x27;</span>hacker<span class=\"string\">&#x27;,&#x27;</span><span class=\"number\">38</span>a74f<span class=\"string\">&#x27;); # </span></span><br></pre></td></tr></table></figure>\n<p>Reset email (or password, etc.) </p>\n  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;; UPDATE USERS SET email=&#x27;</span>hacker<span class=\"variable\">@root</span>.org<span class=\"string\">&#x27;  </span></span><br><span class=\"line\"><span class=\"string\"> WHERE email=&#x27;</span>victim<span class=\"variable\">@yahoo</span>.com<span class=\"string\">&#x27;; #</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Second-Order SQL Injections</p>\n  <figure class=\"highlight php\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">  <span class=\"variable\">$db</span> = <span class=\"title function_ invoke__\">mysql_connect</span>(<span class=\"string\">&quot;localhost&quot;</span>, <span class=\"string\">&quot;root&quot;</span>, <span class=\"string\">&quot;password&quot;</span>); </span><br><span class=\"line\">  <span class=\"title function_ invoke__\">mysql_select_db</span>(<span class=\"string\">&quot;Shipping&quot;</span>, <span class=\"variable\">$db</span>); </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"variable\">$id</span> = <span class=\"variable\">$HTTP_GET_VARS</span>[<span class=\"string\">&quot;id&quot;</span>]; </span><br><span class=\"line\">  <span class=\"variable\">$qry</span> = <span class=\"string\">&quot;SELECT ccnum FROM cust WHERE id = <span class=\"subst\">$id</span>&quot;</span>; </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">mysql_query</span>(<span class=\"variable\">$qry</span>, <span class=\"variable\">$db</span>); </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$result</span>) &#123; </span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">mysql_result</span>(<span class=\"variable\">$result</span>, <span class=\"number\">0</span>, <span class=\"string\">&quot;ccnum&quot;</span>); </span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;No result!&quot;</span> . <span class=\"title function_ invoke__\">mysql_error</span>(); </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"> <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>åˆå§‹æ³¨å…¥ï¼šæ”»å‡»è€…è®¾æ³•å°† <code>uname</code> å­—æ®µè®¾ç½®ä¸ºï¼š<code>admin&#39; #</code>ã€‚<br>åœ¨å¦ä¸€ä¸ªæ´»åŠ¨ä¸­ï¼Œä¾‹å¦‚å¯†ç æ›´æ–°æ“ä½œï¼Œä»£ç å¯èƒ½ä¼šä½¿ç”¨ä¹‹å‰å­˜å‚¨çš„ <code>uname</code> å€¼ã€‚å› ä¸º <code>uname</code> åŒ…å«æ³¨é‡Šç¬¦å·ï¼Œå®é™…æ‰§è¡Œçš„ SQL è¯­å¥å°†å˜æˆï¼š</p>\n  <figure class=\"highlight sql\"><figcaption><span>Example</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> USERS <span class=\"keyword\">SET</span> passwd<span class=\"operator\">=</span><span class=\"string\">&#x27;cracked&#x27;</span> <span class=\"keyword\">WHERE</span> uname<span class=\"operator\">=</span><span class=\"string\">&#x27;admin&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>Persistent storage (such as a table row) is deemed as a <strong>trusted source</strong> thus may not be sanitised<br>Attacks may be subsequently executed by <strong>multiple</strong> activities</p>\n</li>\n</ol>\n<h1 id=\"Preventing SQL Injection\" class=\"active\"><a class=\"anchor\"  href=\"#Preventing SQL Injection\">#</a>Preventing SQL Injection</h1>\n\n<ol>\n<li>Finding SQL Injection Vulnerabilities<br>Any application that has the following pattern is at risk of SQL injection <ol>\n<li>Take user input </li>\n<li>Do not check validity of user input </li>\n<li>Use user input data to query a database </li>\n<li>Use string manipulation to build the SQL query or the SQL exec command</li>\n</ol>\n</li>\n</ol>\n<ul>\n<li>Manual Techniques<br>Try entering junk SQL commands into input fields you suspect may not be validated <ul>\n<li>Use as username: <code>abc&#39; JFKDJ #</code><br>Look for errors or unexpected behaviour </li>\n<li>Some web applications running in debug mode will show you the whole SQL statement to â€œhelp you debugâ€, but this also helps attackers attack</li>\n<li>å¸¸è§çš„æ‰‹åŠ¨æµ‹è¯•å­—ç¬¦ä¸²ï¼š<br><code>&#39; OR 1=1 --</code>ï¼šç»•è¿‡èº«ä»½éªŒè¯ã€‚<br><code>&#39; UNION SELECT NULL, NULL, NULL --</code>ï¼šå°è¯•è®¿é—®å…¶ä»–è¡¨ä¸­çš„æ•°æ®ã€‚<br><code>&#39; AND (SELECT COUNT(*) FROM users) &gt; 0 --</code>ï¼šæ£€æµ‹æŸ¥è¯¢é€»è¾‘ã€‚</li>\n</ul>\n</li>\n<li>Automated Techniques<ol>\n<li>Sqlmap (sqlmap.org) profiles the database on a given URL</li>\n</ol>\n<ul>\n<li>Identify vulnerable parameters </li>\n<li>Identify which types of attacks work </li>\n<li>Take over the database</li>\n</ul>\n<ol start=\"2\">\n<li>SQL Inject Me was a Firefox add-on</li>\n</ol>\n<ul>\n<li>Try standard SQL injection techniques for a variety of database languages </li>\n<li>In every form on a page</li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>Preventing SQL Injection<ol>\n<li>Input validation</li>\n</ol>\n<ul>\n<li>Filter any character with special meanings (apostrophes, semicolons, percent symbols, hyphens, etc.) </li>\n<li>Check the data type (e.g. make sure itâ€™s an integer) </li>\n<li>Blacklisting â€œbadâ€ characters doesnâ€™t always work <ol>\n<li>Could prevent valid input (e.g. last name Oâ€™Brien) </li>\n<li>Forget to filter out some characters</li>\n</ol>\n</li>\n</ul>\n<ol start=\"2\">\n<li>Escaping quotes<br> Use escape characters to prevent the quote from becoming part of the query. Example: convert <code>&#39; </code> into <code> \\&#39;</code>. Different databases have different rules for escaping </li>\n<li>Whitelisting</li>\n</ol>\n<ul>\n<li>Allow only well-defined set of safe values </li>\n<li>Set implicitly defined through regular expressionsæ­£åˆ™è¡¨è¾¾å¼</li>\n</ul>\n</li>\n<li>Best Solution: Prepared Statements( Separating code and data)<br>In most injection attacks, data is interpreted as control: this changes the semantics of a query or a command</li>\n</ol>\n<ul>\n<li>Typed bind variables: <code>? </code>placeholders guaranteed to be data (not control) </li>\n<li>Prepared statements are <strong>pre-compiled</strong> by the database management system waiting for input </li>\n<li>Placeholders prevent that the users input gets attached to the SQL query resulting in a separation of code and data </li>\n<li>For example, the database registers <code>&#39;Robert&#39; ); DROP TABLE Students;--&#39;</code><figure class=\"highlight java\"><figcaption><span>Prepared Statement: Java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">PreparedStatement</span> <span class=\"variable\">ps</span> <span class=\"operator\">=</span> db.prepareStatement(</span><br><span class=\"line\">  <span class=\"string\">&quot;SELECT pizza, toppings, quantity, </span></span><br><span class=\"line\"><span class=\"string\">  order_day FROM orders WHERE userid=? </span></span><br><span class=\"line\"><span class=\"string\">  AND order_month=?&quot;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"> ps.setInt(<span class=\"number\">1</span>, session.getCurrentUserId());</span><br><span class=\"line\"> ps.setInt(<span class=\"number\">2</span>, Integer.parseInt(request.getParameter(<span class=\"string\">&quot;month&quot;</span>)));</span><br><span class=\"line\"> <span class=\"type\">ResultSet</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> ps.executeQuery();</span><br></pre></td></tr></table></figure></li>\n<li>ä½¿ç”¨é¢„å¤„ç†è¯­å¥ (PreparedStatement)<br><code>PreparedStatement</code> æ˜¯ Java ä¸­ç”¨äºæ‰§è¡Œé¢„ç¼–è¯‘çš„ SQL è¯­å¥çš„å¯¹è±¡ï¼Œå®ƒç¡®ä¿ SQL æŸ¥è¯¢ç»“æ„å’Œè¾“å…¥æ•°æ®çš„åˆ†ç¦»ã€‚åœ¨æ­¤ä»£ç ä¸­ï¼Œä½¿ç”¨ <code>?</code> å ä½ç¬¦æ¥æ ‡è®°ç”¨æˆ·è¾“å…¥çš„ä½ç½®ï¼Œç¡®ä¿è¾“å…¥çš„æ•°æ®ä¸è¢«è§£é‡Šä¸º SQL æ§åˆ¶é€»è¾‘ã€‚</li>\n<li>ç»‘å®šå˜é‡<br>é€šè¿‡ <code>ps.setInt(1, ...)</code> å’Œ <code>ps.setInt(2, ...)</code> æ–¹æ³•ï¼Œå°†<code>ç”¨æˆ· ID</code> å’Œ<code>æœˆä»½</code>å‚æ•°ç»‘å®šåˆ°ç›¸åº”çš„å ä½ç¬¦ä¸Šã€‚<br>ç»‘å®šçš„å˜é‡å…·æœ‰æ˜ç¡®çš„ç±»å‹ï¼ˆå¦‚ intã€String ç­‰ï¼‰ï¼Œè¿™ç¡®ä¿äº†è¾“å…¥æ•°æ®ä¸ä¼šæ”¹å˜ SQL æŸ¥è¯¢çš„é€»è¾‘ã€‚ <figure class=\"highlight csharp\"><figcaption><span>Prepared Statement: ASP.NET</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SqlCommand cmd = <span class=\"keyword\">new</span> SqlCommand(</span><br><span class=\"line\">  <span class=\"string\">&quot;SELECT * FROM UserTable </span></span><br><span class=\"line\"><span class=\"string\">   WHERE username = @User AND password = @Pwd&quot;</span>, </span><br><span class=\"line\">   dbConnection</span><br><span class=\"line\"> );</span><br><span class=\"line\"> cmd.Parameters.Add(<span class=\"string\">&quot;@User&quot;</span>, Request[<span class=\"string\">&quot;user&quot;</span>]);</span><br><span class=\"line\"> cmd.Parameters.Add(<span class=\"string\">&quot;@Pwd&quot;</span>, Request[<span class=\"string\">&quot;pwd&quot;</span>]);</span><br><span class=\"line\"> cmd.ExecuteReader();</span><br></pre></td></tr></table></figure></li>\n<li>æŸ¥è¯¢è¯­å¥ä¸­çš„ <code>@User</code> å’Œ <code>@Pwd</code> æ˜¯å‚æ•°å ä½ç¬¦ï¼Œç”¨äºæ ‡è®°ç”¨æˆ·è¾“å…¥çš„ä½ç½®ã€‚<figure class=\"highlight php\"><figcaption><span>Prepared Statement: PHP</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\"> <span class=\"variable\">$db</span> = <span class=\"title function_ invoke__\">mysqli_connect</span>(<span class=\"title function_ invoke__\">getServer</span>(), <span class=\"title function_ invoke__\">getUid</span>(), <span class=\"title function_ invoke__\">getPwd</span>()); </span><br><span class=\"line\"> <span class=\"variable\">$stmt</span> = <span class=\"title function_ invoke__\">mysqli_prepare</span>(<span class=\"variable\">$db</span>, <span class=\"string\">&quot;SELECT ccnum FROM cust WHERE id = ?&quot;</span>); </span><br><span class=\"line\"> <span class=\"variable\">$id</span> = <span class=\"variable\">$HTTP_GET_VARS</span>[<span class=\"string\">&quot;id&quot;</span>]; </span><br><span class=\"line\"> <span class=\"comment\">// ä»…å…è®¸æœ‰æ•ˆçš„IDï¼ˆ1-8ä½æ•°å­—ï¼‰</span></span><br><span class=\"line\"> <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/^\\d&#123;1,8&#125;$/&#x27;</span>, <span class=\"variable\">$id</span>)) &#123; </span><br><span class=\"line\">     <span class=\"title function_ invoke__\">mysqli_stmt_bind_param</span>(<span class=\"variable\">$stmt</span>, <span class=\"string\">&quot;s&quot;</span>, <span class=\"variable\">$id</span>); </span><br><span class=\"line\">     <span class=\"title function_ invoke__\">mysqli_stmt_execute</span>(<span class=\"variable\">$stmt</span>); </span><br><span class=\"line\"> &#125; </span><br><span class=\"line\"> <span class=\"title function_ invoke__\">mysqli_stmt_bind_result</span>(<span class=\"variable\">$stmt</span>, <span class=\"variable\">$result</span>); </span><br><span class=\"line\"> <span class=\"title function_ invoke__\">mysqli_stmt_fetch</span>(<span class=\"variable\">$stmt</span>); </span><br><span class=\"line\"> ...</span><br><span class=\"line\"> <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>SQL æŸ¥è¯¢ä¸­ä½¿ç”¨ <code>?</code> ä½œä¸ºå ä½ç¬¦ï¼Œè¡¨ç¤ºå‚æ•°çš„ä½ç½®</li>\n<li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>preg_match(&#39;/^\\d&#123;1,8&#125;$/&#39;, $id)</code> æ¥éªŒè¯ç”¨æˆ·è¾“å…¥ã€‚è¿™ç¡®ä¿äº†è¾“å…¥æ˜¯ 1 åˆ° 8 ä½çš„æ•°å­—ï¼Œè¿‡æ»¤æ‰äº†æ½œåœ¨çš„æ¶æ„è¾“å…¥</li>\n<li>ä½¿ç”¨ <code>mysqli_stmt_bind_param($stmt, &quot;s&quot;, $id)</code> æ–¹æ³•å°†ç”¨æˆ·è¾“å…¥çš„ ID ä½œä¸ºå‚æ•°ç»‘å®šåˆ°é¢„å¤„ç†è¯­å¥ä¸­ã€‚å‚æ•°ç±»å‹ <code>s</code> æŒ‡å®šç»‘å®šçš„å˜é‡æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆstringï¼‰ã€‚</li>\n</ul>\n<ol start=\"4\">\n<li>Fixing SQL Injections</li>\n</ol>\n<ul>\n<li>Validate all input </li>\n<li>Never use string concatenation to build SQL statements </li>\n<li>Use parameterised stored procedures or other functions for database access </li>\n<li>Use least privileged accounts to connect to the database </li>\n<li>Remove access to all user defined tables and grant access only to stored procedures</li>\n</ul>\n",
            "tags": [
                "software security",
                "SQL"
            ]
        }
    ]
}